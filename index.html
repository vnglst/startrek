<meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />

<body style=margin:0>
    <canvas id=starfield />
    <audio id='enginesound' src='sounds/tng_room.mp3' autoplay loop />
    <script>
        // Star types and their colors
        // Source: http://www.vendian.org/mncharity/dir3/starcolor/
        const starTypes = [{
                type: 'O',
                trueColor: 'rgb(155, 176, 255)',
                visibleColor: 'rgb(195, 195, 195)'
            },
            {
                type: 'B',
                trueColor: 'rgb(170, 191, 255)',
                visibleColor: 'rgb(205, 205, 205)'
            },
            {
                type: 'A',
                trueColor: 'rgb(202, 215, 255)',
                visibleColor: 'rgb(224, 224, 224)'
            },
            {
                type: 'F',
                trueColor: 'rgb(248, 247, 255)',
                visibleColor: 'rgb(250, 250, 250)'
            },
            {
                type: 'G',
                trueColor: 'rgb(255, 244, 234)',
                visibleColor: 'rgb(244, 244, 244)'
            },
            {
                type: 'K',
                trueColor: 'rgb(255, 210, 161)',
                visibleColor: 'rgb(209, 209, 209)'
            },
            {
                type: 'M',
                trueColor: 'rgb(255, 204, 111)',
                visibleColor: 'rgb(190, 190, 190)'
            },
        ]

        var starfield = document.getElementById('starfield');
        var engineSound = document.getElementById('enginesound');
        var scr = window.screen;
        var width = starfield.width = scr.width;
        var height = starfield.height = scr.height;
        var numberOfStars = width / 5;
        var xSpeedModifier = 0.25;
        var ySpeedModifier = 0;
        var showTrueColors = true;

        // Moving the mouse across the canves changes x and y speed
        function handleMouseMove(p) {
            p.preventDefault();
            if (engineSound.paused) engineSound.play();
            xSpeedModifier = (p.pageX - (width / 2)) / width * 2;
            ySpeedModifier = (p.pageY - (height / 2)) / height * 2;
        }
        starfield.addEventListener('mousemove', handleMouseMove, false);
        starfield.addEventListener('touchstart', handleMouseMove, false);
        starfield.addEventListener('touchmove', handleMouseMove, false);

        // Get random element from array
        getRandomElement = function (arr) {
            return arr[Math.floor((Math.random() * arr.length))];
        }

        // Create an empty array of stars
        var stars = [];

        // creates one star
        function createStar() {
            var speed = Math.random() * 1.5 + 0.5;
            var starType = getRandomElement(starTypes)
            return {
                trueColor: starType.trueColor,
                visibleColor: starType.visibleColor,
                x: Math.random() * starfield.width,
                y: Math.random() * starfield.height,
                size: Math.random() * 2,
                xSpeed: speed,
                ySpeed: speed
            }
        }

        // adds one star to array
        function addStar() {
            stars.push(createStar())
        }

        // adds n stars to array
        function addNStars(n) {
            for (var i = 0; i < n; i++) addStar()
        }

        // generates initial stars
        addNStars(numberOfStars);

        // clicking on the canvas adds stars
        function handleClickEvent(e) {
            e.preventDefault();
            addNStars(100);
        }

        starfield.addEventListener('click', handleClickEvent, false)

        function handleMouseEnter(e) {
            e.preventDefault();
            showTrueColors = true;
        }

        function handleMouseLeave(e) {
            e.preventDefault();
            showTrueColors = false;
        }

        // Toggles visible and true colors on leaving/entering canvas
        starfield.addEventListener('mouseenter', handleMouseEnter, false)
        starfield.addEventListener('mouseleave', handleMouseLeave, false)


        function draw() {
            var ctx = starfield.getContext('2d');

            // Redraw screen in black with alpha channel for fading of stars
            ctx.fillStyle = 'rgba(0, 0, 0, .2)';
            ctx.fillRect(0, 0, width, height);

            // Loop through all stars, draw them and add +1 to position
            stars.map(function (star, index) {

                // Star color
                ctx.fillStyle = showTrueColors ? star.trueColor : star.visibleColor;

                // Plot star
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2, true);
                ctx.closePath();
                ctx.fill()

                // Increase star position with speed, check edges
                star.x = star.x < 0 ?
                    star.x = width - 1 :
                    star.x + (xSpeedModifier * star.xSpeed);
                star.x = star.x % width

                star.y = star.y < 0 ?
                    star.y = height - 1 :
                    star.y + (ySpeedModifier * star.ySpeed);
                star.y = star.y % height

            });
        };

        // Call function draw with an interval
        setInterval(draw, 10);
    </script>

    <script>
        // Google Analytics, ignore
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-43209054-1', 'koenvangilst.nl');
        ga('send', 'pageview');
    </script>
</body>